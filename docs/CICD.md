# CI/CD ä»‹ç´¹ã€æ“ä½œèªªæ˜

## ğŸ§© ç¸½è¦½ï¼ˆSummaryï¼‰  
æŒçºŒæ•´åˆï¼ˆCIï¼‰èˆ‡æŒçºŒäº¤ä»˜ï¼éƒ¨ç½²ï¼ˆCDï¼‰æ˜¯ç¾ä»£è»Ÿé«”é–‹ç™¼èˆ‡é‹ç¶­ï¼ˆDevOpsï¼‰æµç¨‹ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œèƒ½é€éè‡ªå‹•åŒ–ç®¡é“å°‡ç¨‹å¼ç¢¼å¾æ’°å¯«éšæ®µä¸€è·¯é€åˆ°ç”Ÿç”¢ç’°å¢ƒï¼Œé”æˆã€Œå¿«é€Ÿã€ç©©å®šã€å¯é‡è¤‡ã€çš„äº¤ä»˜æµç¨‹ã€‚CI/CD çš„ä¸»è¦åƒ¹å€¼åœ¨æ–¼ï¼š  
1. ğŸ“¦ **è‡ªå‹•åŒ–å»ºç½®èˆ‡æ¸¬è©¦**ï¼šæ¯æ¬¡ç¨‹å¼ç¢¼æäº¤ï¼ˆCommitï¼‰å¾Œè‡ªå‹•åŒ–åŸ·è¡Œå»ºç½®èˆ‡æ¸¬è©¦ï¼Œç¢ºä¿ç¨‹å¼å“è³ªï¼›  
2. ğŸš€ **å¿«é€Ÿéƒ¨ç½²èˆ‡äº¤ä»˜**ï¼šå°‡å»ºç½®æˆåŠŸçš„ç”¢ç‰©å¿«é€Ÿéƒ¨ç½²åˆ°æ¸¬è©¦æˆ–æ­£å¼ç’°å¢ƒï¼Œç¸®çŸ­ç™¼å¸ƒé€±æœŸï¼Œä¸¦é™ä½äººç‚ºæ“ä½œå¤±èª¤ï¼›  
3. ğŸ”„ **æŒçºŒè¿­ä»£èˆ‡å›é¥‹**ï¼šé€éç›£æ§èˆ‡å›å ±æ©Ÿåˆ¶å³æ™‚åµæ¸¬ç”Ÿç”¢ç’°å¢ƒå•é¡Œï¼Œç¢ºä¿æ¯æ¬¡è®Šæ›´éƒ½èƒ½å¿«é€Ÿå›é¥‹ä¸¦ä¿®æ­£ï¼Œçªç ´å‚³çµ±ã€Œæ‰‹å‹•éƒ¨ç½²â†’äººå·¥æ¸¬è©¦â†’å›å ±éŒ¯èª¤ã€çš„ç“¶é ¸ã€‚  

---

## ğŸ“š ç°¡ä»‹  
- ğŸ§± **ä»€éº¼æ˜¯ CIï¼ˆContinuous Integration, æŒçºŒæ•´åˆï¼‰ï¼Ÿ**  
  - CI æ—¨åœ¨å°‡ã€Œéœ€æ±‚è¦åŠƒ â†’ ç¨‹å¼ç¢¼æ’°å¯« â†’ å»ºç½®ï¼ˆBuildï¼‰ â†’ æ¸¬è©¦ï¼ˆTestï¼‰ã€ç­‰æ­¥é©Ÿè‡ªå‹•åŒ–ï¼Œè®“é–‹ç™¼è€…èƒ½å¤ éš¨æ™‚å°‡æœ¬åœ°ç¨‹å¼å®‰å…¨åœ°åˆä½µåˆ°ä¸»åˆ†æ”¯ï¼ˆmaster/mainï¼‰ï¼Œä¸¦åœ¨åŒä¸€ç’°å¢ƒä¸­åŸ·è¡Œå–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦ï¼Œæ¸›å°‘ç’°å¢ƒå·®ç•°èˆ‡äººç‚ºç–å¤±ã€‚  
  - å…¸å‹æµç¨‹ï¼šé–‹ç™¼è€…å°‡ç¨‹å¼ç¢¼ Push åˆ° GitHub/GitLab/Bitbucket ç­‰ç‰ˆæœ¬æ§åˆ¶ç³»çµ±å¾Œï¼ŒCI å·¥å…·ï¼ˆå¦‚ Jenkinsã€GitLab CIã€CircleCIï¼‰æœƒè‡ªå‹•æ‹‰å–ç¨‹å¼ç¢¼é€²è¡Œå»ºç½®èˆ‡æ¸¬è©¦ï¼Œä¸¦åœ¨å¤±æ•—æ™‚ç«‹åˆ»é€šçŸ¥é–‹ç™¼è€…é€²è¡Œä¿®å¾©ã€‚  

- ğŸ—ï¸ **ä»€éº¼æ˜¯ CDï¼ˆContinuous Delivery / Continuous Deploymentï¼ŒæŒçºŒäº¤ä»˜ï¼æŒçºŒéƒ¨ç½²ï¼‰ï¼Ÿ**  
  - CD å¯ç´°åˆ†ç‚ºå…©ç¨®ï¼š  
    1. **æŒçºŒäº¤ä»˜ï¼ˆContinuous Deliveryï¼‰**ï¼šå»ºç½®èˆ‡æ¸¬è©¦å®Œæˆå¾Œï¼Œè‡ªå‹•å°‡å¯éƒ¨ç½²çš„å»ºç½®ç”¢ç‰©éƒ¨ç½²åˆ°æº–ç”Ÿç”¢ï¼ˆStagingï¼‰ç’°å¢ƒï¼Œéœ€è¦äººå·¥æŒ‰ä¸‹æŒ‰éˆ•æ‰èƒ½æ¨å‘æ­£å¼ç”Ÿç”¢ï¼ˆProductionï¼‰ã€‚  
    2. **æŒçºŒéƒ¨ç½²ï¼ˆContinuous Deploymentï¼‰**ï¼šåœ¨æ¸¬è©¦é€šéå¾Œï¼Œè‡ªå‹•ç„¡ç¸«å°‡æœ€æ–°ç¨‹å¼æ¨å‘ç”Ÿç”¢ç’°å¢ƒï¼Œå…¨ç¨‹ç„¡éœ€äººå·¥å¹²é ï¼Œé©ç”¨æ–¼éœ€è¦æ¥µé€Ÿæ›´æ–°çš„å°æ­¥å¿«è·‘åœ˜éšŠã€‚  
  - CD æµç¨‹ï¼šç•¶ CI å»ºç½®èˆ‡æ¸¬è©¦éšæ®µé€šéå¾Œï¼Œç³»çµ±ä¾¿æœƒé€²å…¥ã€ŒRelease â†’ Deploy â†’ Operate â†’ Monitorã€éšæ®µï¼Œé€éè‡ªå‹•åŒ–å·¥å…·å°‡ç¨‹å¼ä½ˆç½²åˆ°ä¼ºæœå™¨æˆ–å®¹å™¨å¹³å°ï¼Œä¸¦æŒçºŒç›£æ§æœå‹™ç‹€æ…‹ï¼Œç™¼ç¾ç•°å¸¸å³æ™‚æ¨é€è­¦ç¤ºçµ¦ç¶­é‹åœ˜éšŠï¼Œç¢ºä¿æœå‹™é«˜å¯ç”¨æ€§èˆ‡ç©©å®šåº¦ã€‚  

---

## ğŸ”„ æµç¨‹è©³è§£  

### ğŸ› ï¸ CI æµç¨‹  
1. **Plan & Code**ï¼šåœ¨ Git å¹³è‡ºä¸Šå»ºç«‹ Issue æˆ–ä½¿ç”¨è€…æ•…äº‹ï¼ˆUser Storyï¼‰ï¼Œé–‹ç™¼è€…ä¾éœ€æ±‚å»ºç«‹åˆ†æ”¯ï¼ˆFeature Branchï¼‰ï¼Œé–‹å§‹æ’°å¯«ç¨‹å¼ç¢¼ã€‚  
2. **Build**ï¼šCI å·¥å…·ï¼ˆå¦‚ Jenkinsã€GitLab CIã€CircleCIï¼‰è‡ªå‹•å¾ Git å€‰åº«æ‹‰å–åˆ†æ”¯ç¨‹å¼ç¢¼ï¼Œä½¿ç”¨é å…ˆå®šç¾©çš„å»ºç½®è…³æœ¬ï¼ˆå¦‚ Mavenã€Gradleã€npmã€Webpackï¼‰å°‡åŸå§‹ç¢¼æ‰“åŒ…æˆå¯éƒ¨ç½²çš„äºŒé€²ä½æˆ–å®¹å™¨æ˜ åƒæª”ã€‚  
3. **Test**ï¼šå»ºç½®å®Œæˆå¾Œè§¸ç™¼è‡ªå‹•åŒ–æ¸¬è©¦ï¼ˆå–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€éœæ…‹åŸå§‹ç¢¼åˆ†æã€å®‰å…¨æƒæï¼‰ï¼Œç¢ºä¿ç¨‹å¼åŠŸèƒ½æ­£å¸¸ä¸”ç„¡é‡å¤§æ¼æ´ã€‚  
4. **Merge**ï¼šæ‰€æœ‰æ¸¬è©¦é€šéå¾Œï¼Œå¯è‡ªå‹•æˆ–æ‰‹å‹•å°‡åˆ†æ”¯ Merge å›ä¸»åˆ†æ”¯ï¼Œä¸¦åœ¨ä¸»åˆ†æ”¯æŒçºŒé€²è¡Œä¸‹æ¬¡å¾ªç’°ã€‚  

> âœ¨ **Tip**ï¼šå»ºè­°å°‡æ¸¬è©¦åˆ†ç‚ºå¿«é€Ÿå›æ­¸æ¸¬è©¦ï¼ˆQuick Testsï¼‰èˆ‡å®Œæ•´æ¸¬è©¦ï¼ˆFull Testsï¼‰ï¼Œå°‡å¿«é€Ÿæ¸¬è©¦æ”¾åœ¨ CI æµç¨‹æœ€å‰æ–¹ï¼Œå¦‚æ­¤å¯æ›´å¿«ç™¼ç¾ç¨‹å¼åŸºç¤éŒ¯èª¤ï¼Œå†è¦–æƒ…æ³åŸ·è¡Œè¼ƒè€—æ™‚çš„æ¸¬è©¦ã€‚  

### ğŸš€ CD æµç¨‹  
1. **Release**ï¼šCI é€šéå¾Œï¼Œç”¢å‡ºå¯éƒ¨ç½²å»ºç½®ç”¢ç‰©ï¼ˆArtifactï¼‰ï¼Œæ¨™ä¸Šç‰ˆæœ¬è™Ÿæˆ– Tagï¼Œä¸¦å­˜æ”¾è‡³ Artifact Repositoryï¼ˆå¦‚ Docker Registryã€Nexusã€Artifactoryï¼‰ã€‚  
2. **Deploy**ï¼šå°‡å»ºç½®ç”¢ç‰©è‡ªå‹•åŒ–éƒ¨ç½²è‡³æ¸¬è©¦ç’°å¢ƒï¼ˆStagingï¼‰æˆ–ç”Ÿç”¢ç’°å¢ƒï¼ˆProductionï¼‰ï¼Œå¯çµåˆå®¹å™¨åŒ–å¹³è‡ºï¼ˆDocker + Kubernetesï¼‰ã€Serverless æ¶æ§‹æˆ–é›²ç«¯æœå‹™ï¼ˆAWSã€GCPã€Azureï¼‰ã€‚  
3. **Operate**ï¼šé€éåŸºç¤æ¶æ§‹å³ç¨‹å¼å®£å‘Šï¼ˆInfrastructure as Codeï¼ŒIaCï¼‰å·¥å…·ï¼ˆå¦‚ Terraformã€Pulumiã€Ansibleï¼‰ï¼Œç¢ºä¿ç’°å¢ƒå¯é‡ç¾æ€§ï¼Œä¸¦åœ¨éƒ¨ç½²å¾Œé€²è¡Œå¿…è¦çš„ç’°å¢ƒé…ç½®èª¿æ•´æˆ–è³‡æ–™åº«é·ç§»ã€‚  
4. **Monitor**ï¼šåˆ©ç”¨ç›£æ§èˆ‡æ—¥èªŒç³»çµ±ï¼ˆå¦‚ Prometheus + Grafanaã€ELK Stackã€Datadogï¼‰å³æ™‚ç›£æ¸¬æœå‹™é‹è¡Œç‹€æ…‹ï¼Œä¸¦æ•´åˆå‘Šè­¦æ©Ÿåˆ¶ï¼ˆWebhookã€Slackã€Telegramã€PagerDutyï¼‰å°‡ç•°å¸¸é€šçŸ¥åœ˜éšŠï¼Œå¿«é€ŸéŸ¿æ‡‰èˆ‡ä¿®å¾©ã€‚  

---

## ğŸŒŸ CI/CD çš„å„ªé»  
1. âš¡ **åŠ å¿«é–‹ç™¼é€Ÿåº¦**ï¼šè‡ªå‹•åŒ–å»ºç½®èˆ‡æ¸¬è©¦å¯å¤§å¹…ç¸®çŸ­æ¯æ¬¡æäº¤çš„å›é¥‹æ™‚é–“ï¼Œé–‹ç™¼è€…éš¨æ™‚å¯çœ‹åˆ°ç¨‹å¼æ˜¯å¦é€šéæ¸¬è©¦ï¼Œé¿å…æ‰‹å‹•æ¸¬è©¦æ‹–å»¶å°ˆæ¡ˆé€²åº¦ã€‚  
2. ğŸ“ˆ **æå‡å“è³ªèˆ‡å¯é åº¦**ï¼šé€éä¸€è‡´çš„æ¸¬è©¦èˆ‡å»ºç½®ç’°å¢ƒï¼Œæ¸›å°‘ã€Œåœ¨æœ¬åœ°å¯è·‘ã€åˆ°ä¼ºæœå™¨å»å ±éŒ¯ã€çš„å•é¡Œï¼Œä¸¦è¼”ä»¥å®‰å…¨æƒæå·¥å…·æª¢æ¸¬æ˜ åƒæª”æ¼æ´ï¼Œé™ä½ç³»çµ±é¢¨éšªã€‚  
3. ğŸ”„ **æŒçºŒè¿­ä»£**ï¼šå¿«é€Ÿå›é¥‹å¾ªç’°è®“åœ˜éšŠèƒ½æ›´é »ç¹åœ°äº¤ä»˜æ–°åŠŸèƒ½ï¼Œä¸¦åœ¨éŒ¯èª¤ç™¼ç”Ÿå¾ŒåŠæ™‚ä¿®å¾©ï¼Œå½¢æˆã€ŒæŒçºŒå¯«ç¨‹å¼ â†’ æŒçºŒé›†æˆ â†’ æŒçºŒäº¤ä»˜ â†’ æŒçºŒç›£æ§ã€çš„é–‰ç’°ã€‚  
4. ğŸ¤ **å¢é€²åœ˜éšŠå”ä½œ**ï¼šCI/CD é€éçµ±ä¸€çš„ç®¡é“ã€æ˜ç¢ºçš„å»ºç½®èˆ‡éƒ¨ç½²æ­¥é©Ÿï¼Œè®“é–‹ç™¼ã€æ¸¬è©¦ã€ç¶­é‹äººå“¡èƒ½åœ¨åŒä¸€æµç¨‹ä¸Šå”åŒå·¥ä½œï¼Œé¿å…è·è²¬é‡ç–Šæˆ–è¨Šæ¯è½å·®ã€‚  

---

## ğŸ› ï¸ å¸¸è¦‹ CI/CD å·¥å…·  
1. **Jenkins**ï¼ˆé–‹æºè‡ªå»ºæ–¹æ¡ˆï¼‰  
   - åŠŸèƒ½ï¼šæ”¯æ´æ•¸åƒç¨®æ’ä»¶ï¼Œå¯èˆ‡ Gitã€Dockerã€Kubernetesã€Slack ç­‰ç„¡ç¸«æ•´åˆï¼Œéˆæ´»æ€§é«˜ä½†éœ€è‡ªè¡Œç¶­è­·èˆ‡å‡ç´šã€‚  
   - é©ç”¨å ´æ™¯ï¼šä¼æ¥­è‡ªæœ‰ç§æœ‰é›²æˆ–è‡ªå»ºä¼ºæœå™¨ï¼Œéœ€é«˜åº¦å®¢è£½åŒ– Pipeline ä¸”å…·å‚™ç¶­é‹èƒ½åŠ›çš„åœ˜éšŠã€‚  

2. **GitLab CI/CD**ï¼ˆçµåˆç‰ˆæœ¬æ§åˆ¶èˆ‡ CI/CDï¼‰  
   - åŠŸèƒ½ï¼šç›´æ¥èˆ‡ GitLab Repository æ•´åˆï¼Œä½¿ç”¨ `.gitlab-ci.yml` å®šç¾© Pipelineï¼Œæä¾›å…è²» Runnerã€Auto DevOpsã€å®¹å™¨æƒæç­‰åŠŸèƒ½ã€‚  
   - é©ç”¨å ´æ™¯ï¼šGitLab å¹³è‡ºç”¨æˆ¶ï¼Œæƒ³è¦ã€Œä¸€ç«™å¼ã€ç®¡ç†ç‰ˆæ§ã€Issueã€CI/CD èˆ‡ Docker Registry çš„åœ˜éšŠã€‚  

3. **GitHub Actions**ï¼ˆGitHub å¹³è‡ºå…§å»º CI/CDï¼‰
   - åŠŸèƒ½ï¼šé€é YAML æª”æ¡ˆå®šç¾©å·¥ä½œæµç¨‹ï¼Œæ”¯æ´å¤šç¨®è§¸ç™¼äº‹ä»¶ï¼ˆå¦‚ Pull Requestã€Pushã€Issueï¼‰ï¼Œä¸¦å¯ä½¿ç”¨ Marketplace ä¸Šçš„ Actions ä¾†æ“´å±•åŠŸèƒ½ã€‚  
   - é©ç”¨å ´æ™¯ï¼šGitHub å„²å­˜åº«ç”¨æˆ¶ï¼Œéœ€å¿«é€Ÿä¸Šæ‰‹ä¸”ç„¡éœ€é¡å¤–ç¶­è­· CI/CD ç’°å¢ƒçš„åœ˜éšŠã€‚

---

## æ“ä½œèªªæ˜ - Github Actions Runner å»ºç«‹
1. å‰ç½®æ¢ä»¶
    - ğŸ³ [Docker ç¤¾ç¾¤ç‰ˆ](./Docker.md) å·²å®‰è£å®Œæˆ
    - ğŸ–¥ï¸ CI VM èˆ‡ CD VM å·²å»ºç«‹ä¸¦å¯ SSH ç™»å…¥
        - CI VM IP: 192.168.0.241
        - CD VM IP: 192.168.0.242
2. SSH ç™»å…¥
    ğŸ”‘ SSH éºå¿˜é‡‘é‘°(å¯é¸ï¼Œå› ç‚ºæˆ‘ä¸Šä¸€æ­¥æ˜¯è¨­å®šIPï¼Œæ‰€ä»¥å…ˆç§»é™¤é‡‘é‘°)
    ```bash
    ssh-keygen -R 192.168.0.241
    ssh-keygen -R 192.168.0.242
    ```
    ğŸ–¥ï¸ CI VM SSH ç™»å…¥  
    ```bash
    ssh ubuntu@192.168.0.241
    ```
    ğŸ–¥ï¸ CD VM SSH ç™»å…¥  
    ```bash
    ssh ubuntu@192.168.0.242
    ```
3. ğŸš€ Github å„²å­˜åº«å»ºç«‹ Runner
  - ğŸ› ï¸ å‰å¾€ GitHub å„²å­˜åº«çš„è¨­å®šé é¢ï¼Œé»é¸ "Actions" -> "Runners" -> "New self-hosted runner"ï¼Œé è¨­ Linux
    ![GitHub Runner è¨­å®š](../img/github-runner-add.gif)
  - ğŸ–¥ï¸ å…©å€‹ VM éƒ½è·Ÿéš¨æŒ‡ç¤ºä¸‹è¼‰ä¸¦å®‰è£ Runner
      ğŸ“‚ å»ºç«‹è³‡æ–™å¤¾ï¼Œæ¨è–¦è‡ªå®šåç¨±
      ```bash
      mkdir ai-sample-actions-runner && cd ai-sample-actions-runner
      ```
      â¬‡ï¸ ä¸‹è¼‰ Runner å£“ç¸®æª”ï¼Œè«‹æ ¹æ“š Github å„²å­˜åº«æŒ‡ä»¤ï¼Œä»¥ä¸‹ç‚ºç¯„ä¾‹æŒ‡ä»¤ï¼š
      ```bash
      curl -o actions-runner-linux-x64-2.324.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.324.0/actions-runner-linux-x64-2.324.0.tar.gz
      ```
      ğŸ“¦ è§£å£“ç¸® Runner å£“ç¸®æª”
      ```bash
      tar xzf ./actions-runner-linux-x64-2.324.0.tar.gz
      ```
      âš™ï¸ è¨­å®š Configï¼Œæ¯æ¬¡çš„ Token éƒ½ä¸åŒï¼Œä¸€å€‹ Token åªèƒ½ç”¨ä¸€æ¬¡ï¼Œè«‹æ ¹æ“š Github å„²å­˜åº«æŒ‡ä»¤ï¼Œä»¥ä¸‹ç‚ºç¯„ä¾‹æŒ‡ä»¤ï¼š
      ```bash
      ./config.sh --url https://github.com/TsukiSama9292/AI-Server-Sample --token BADCU6CIOZZ4UAVHPMNBEOTIHPBBO
      
      # è¨­å®š
      >> Enter the name of the runner group to add this runner to: [press Enter for Default] -> ç›´æ¥ Enterï¼Œæˆ–è¼¸å…¥è‡ªå®šåç¨±
      >> Enter the name of runner: [press Enter for ubuntu-2204-ci] -> ç›´æ¥ Enterï¼Œæˆ–è¼¸å…¥è‡ªå®šåç¨±
      >> This runner will have the following labels: 'self-hosted', 'Linux', 'X64' 
      >> Enter any additional labels (ex. label-1,label-2): [press Enter to skip] -> è¼¸å…¥ ci æˆ– cd
      >> Enter name of work folder: [press Enter for _work] -> ç›´æ¥ Enter
      ```
      ğŸ”„ é€šå¸¸è¦åœ¨æ¯æ¬¡é‡å•Ÿæ™‚åŸ·è¡Œ Runnerï¼Œå¯ä»¥ç”¨ `crontab` ä¾†è¨­å®šè‡ªå‹•å•Ÿå‹•
      ```bash
      crontab -e
      >>  no crontab for ubuntu - using an empty one
          Select an editor.  To change later, run 'select-editor'.
            1. /bin/nano        <---- easiest
            2. /usr/bin/vim.basic
            3. /usr/bin/vim.tiny
            4. /bin/ed
      >> é¸æ“‡ 1
      ```
      ğŸ‘‰ æ»‘åˆ°æœ€åº•ä¸‹ï¼ŒåŠ å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œç¢ºä¿æ¯æ¬¡é‡å•Ÿæ™‚éƒ½æœƒåŸ·è¡Œ Runner
      ```bash
      @reboot /home/ubuntu/ai-sample-actions-runner/run.sh
      ```
      ğŸ”„ å®Œæˆå¾Œï¼Œç›´æ¥é‡å•Ÿ VM
      ```bash
      sudo reboot
      ```
  - âœ… å®Œæˆå¾Œï¼Œå›åˆ° GitHub å„²å­˜åº«çš„ Runner è¨­å®šé é¢ï¼Œæ‡‰è©²æœƒçœ‹åˆ°æ–°å»ºç«‹çš„ Runner
    ![GitHub Runner è¨­å®šå®Œæˆ](../img/github-runner-complete.png)